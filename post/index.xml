<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Posts on Sawanoboly.net</title>
    <link>http://www.sawanoboly.net/post/</link>
    <description>Recent content in Posts on Sawanoboly.net</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja-JP</language>
    <lastBuildDate>Mon, 07 Dec 2015 00:00:00 +0900</lastBuildDate>
    <atom:link href="http://www.sawanoboly.net/post/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>AMIMOTO DIE HARD - 死んでも死なないタフさが必要だ。</title>
      <link>http://www.sawanoboly.net/2015/12/ad2015-amimoto_die_hard/</link>
      <pubDate>Mon, 07 Dec 2015 00:00:00 +0900</pubDate>
      
      <guid>http://www.sawanoboly.net/2015/12/ad2015-amimoto_die_hard/</guid>
      <description>

&lt;p&gt;この記事は&lt;a href=&#34;http://www.adventar.org/calendars/1107&#34;&gt;AMIMOTO Advent Calendar 2015&lt;/a&gt; 、12月7日(月)のエントリです。&lt;/p&gt;

&lt;img src=&#34;http://www.sawanoboly.net/images/2015/amimoto_banner.jpg&#34; alt=&#34;&#34; class=&#34;pure-img&#34; &gt;


&lt;h2 id=&#34;あらすじ:8c9a8fc68efb413605d2b51dc15e5bec&#34;&gt;あらすじ&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://ja.amimoto-ami.com&#34;&gt;AMIMOTO AMI&lt;/a&gt;はAWSのPublic AMIとして生まれ、好評を博したのちAWS MarketPlaceに進出した&lt;a href=&#34;https://wordpress.com/&#34;&gt;WordPress&lt;/a&gt;のAMIである。自前で構築するより大抵楽で、今日ではそこいらのWordPress環境より当然応答が速いチートガイに成長した。&lt;/p&gt;

&lt;p&gt;(調べればすぐ判ることなので)詳細は割愛するが、AMIMOTOでは最新のWordPressおよびミドルウェアにいち早く対応するため、AMIには外部処理の取得手続きのみを埋め込み、起動時にWordPressをセットアップしている。&lt;/p&gt;

&lt;p&gt;物語はAMIMOTOを起動したユーザの、ある連絡で幕を開ける。&lt;/p&gt;

&lt;p&gt;『WordPressが動いていない。』&lt;/p&gt;

&lt;p&gt;セットアップを前述のポリシーで行っているAMIMOTOでは、まれに起こるとされる既知の問題としてデジタルキューブ組長も頭を抱える。&lt;br /&gt;
原因はたいていAmazon LinuxのRPMリポジトリ更新による&lt;code&gt;yum update&lt;/code&gt;か、セットアップ手順の変更に起因していた。&lt;/p&gt;

&lt;p&gt;少なくともユーザより先に(AMIからみた)外部要因による問題の発生を検知し、いち早く修正を行なえるようにしたいという相談に対して私が提供した仕組みとは．．．？&lt;/p&gt;

&lt;h2 id=&#34;主要登場物:8c9a8fc68efb413605d2b51dc15e5bec&#34;&gt;主要登場物&lt;/h2&gt;

&lt;dl&gt;
&lt;dt&gt;&lt;a href=&#34;https://ja.amimoto-ami.com&#34;&gt;AMIMOTO AMI&lt;/a&gt;&lt;/dt&gt;
&lt;dd&gt;特徴はあらすじを参照。&lt;br /&gt;シリーズにはVirtualizationのタイプに応じたPVM版とHVM版、およびPHPの実行エンジンにHHVMを採用した(タイプはHVM)の3種類がある。&lt;/dd&gt;
&lt;dt&gt;&lt;a href=&#34;https://github.com/test-kitchen/test-kitchen&#34;&gt;Test-Kitchen&lt;/a&gt;&lt;/dt&gt;
&lt;dd&gt;マシンリソースの調達/破棄を管理し、プロビジョニングとテストを実行するツール。&lt;br /&gt;今作ではCircleCI上で稼働し、AMIからインスタンスの作成およびyum updateを実行、Infratasterの起動を担当した。&lt;/dd&gt;
&lt;dt&gt;&lt;a href=&#34;https://github.com/ryotarai/infrataster&#34;&gt;Infrataster&lt;/a&gt;&lt;/dt&gt;
&lt;dd&gt;インフラの振る舞いをテストするフレームワーク。&lt;br /&gt;得意のCapybaraを使い、WordPressの振る舞いテストを行なう。Javascriptのエラー程度ならば大目に見る(※設定次第)寛大さを持つ。&lt;/dd&gt;
&lt;dt&gt;&lt;a href=&#34;https://circleci.com/&#34;&gt;CircleCI&lt;/a&gt;&lt;/dt&gt;
&lt;dd&gt;CI、いわゆるContinuous Integrationのサービス。&lt;br /&gt;Test-Kitchenの実行と、安否のレポートをする。家訓を守り10分間の沈黙は死とみなすが、今作では回避手段をとられてしまう。&lt;/dd&gt;
&lt;dt&gt;&lt;a href=&#34;https://www.heroku.com&#34;&gt;heroku&lt;/a&gt;&lt;/dt&gt;
&lt;dd&gt;アプリケーション実行のプラットフォーム。&lt;br /&gt;裏設定としてスケジュールタスクが登録されており、CircleCIのビルドを定期的にキックする役で登場。&lt;/dd&gt;
&lt;dt&gt;&lt;a href=&#34;https://ifttt.com/&#34;&gt;IFTTT&lt;/a&gt;&lt;/dt&gt;
&lt;dd&gt;条件によってシンプルなタスクを実行するサービス。&lt;br /&gt;セットアップタスクの変更をRSSで取得し、CircleCIのビルドをキックする遊撃手として暗躍する。&lt;/dd&gt;
&lt;/dl&gt;

&lt;h2 id=&#34;amimoto-die-hard-解説:8c9a8fc68efb413605d2b51dc15e5bec&#34;&gt;『AMIMOTO DIE HARD』 解説&lt;/h2&gt;

&lt;p&gt;結論からいうと、次の条件でテストを回すことにした。対象はAMIMOTOシリーズ全部。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;定期的、毎日一回。

&lt;ul&gt;
&lt;li&gt;リポジトリの変更によるクラッシュを検知。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;セットアップ用コードの変更。

&lt;ul&gt;
&lt;li&gt;セットアップの不備を検知。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;後者もそもそもが、何かのパッケージ更新との合わせ技による発生が主ではあったようだ。&lt;br /&gt;
AMI起動からの大元の仕組みが変わることも考慮にいれて、『ただWordPressがつかえる状態か』のみを確かめる仕組みとしている。&lt;/p&gt;

&lt;p&gt;実施している内容は主要登場物のセクションに書いている通りだが、いくつかピックアップして解説しよう。&lt;/p&gt;

&lt;h3 id=&#34;infratasterによるテストの内訳とコード:8c9a8fc68efb413605d2b51dc15e5bec&#34;&gt;Infratasterによるテストの内訳とコード&lt;/h3&gt;

&lt;p&gt;テストの段取りは次の通り。&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;AMIMOTOのお約束、インスタンスIDの入力において(所有者確認)

&lt;ol&gt;
&lt;li&gt;間違ったIDを入力してハネられること。&lt;/li&gt;
&lt;li&gt;正しいIDを入力し、WordPressのインストール画面に移ること。&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;とりあえずここまでやれば、関連サービスがすべて正常に稼働しているとわかる。
Infrataster(Capybara)では次のようにコードを書いた。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;describe server(:amimoto) do
  describe capybara(&#39;http://amimoto&#39;) do
    it &amp;quot;Blocks invalid string&amp;quot; do
      visit &#39;/wp-admin/install.php&#39;
      fill_in &amp;quot;instance_id&amp;quot;, with: &#39;hogehoge&#39;
      click_button &#39;Next Step&#39;
      expect(page).to have_content &amp;quot;Sorry, that isn’t a valid instance ID.&amp;quot;
    end

    it &amp;quot;Unlock Success&amp;quot; do
      visit &#39;/wp-admin/install.php&#39;
      fill_in &amp;quot;instance_id&amp;quot;, with: ENV[&#39;KITCHEN_SERVER_ID&#39;]
      expect(click_button &#39;Next Step&#39;).not_to be_nil
    end

    it &amp;quot;Should got &#39;Welcome&#39; after unlock&amp;quot; do
      visit &#39;/wp-admin/install.php&#39;
      expect(page).to have_content &#39;ようこそ&#39;
    end
  end
end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;インスタンスID(環境変数)は、Test-Kitchenの機能。&lt;/p&gt;

&lt;h3 id=&#34;test-kithcen-shell-verifier:8c9a8fc68efb413605d2b51dc15e5bec&#34;&gt;Test-Kithcen + Shell-Verifier&lt;/h3&gt;

&lt;p&gt;AMIMOTO DIE HARDの本体はこのTest-Kitchenといえる。&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;AMIからインスタンスを作成する。&lt;/li&gt;
&lt;li&gt;Shell-Provisionerで&lt;code&gt;yum update&lt;/code&gt;をかけ、関連サービスを再起動。&lt;/li&gt;
&lt;li&gt;Shell-VerifierでInfratasterを実行。&lt;/li&gt;
&lt;li&gt;テストの結果にかかわらず、インスタンスを破棄。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;インスタンス関連の設定はただec2ドライバを使ってるだけ。&lt;code&gt;.kitchen.yml&lt;/code&gt;をそのまま貼ると次の通り。&lt;/p&gt;

&lt;p&gt;末尾に突然入っているRubyコードはCircleCI向けの小狡い手段だ。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;---
driver:
  name: ec2
  region: ap-northeast-1
  availability_zone: ap-northeast-1c
  subnet_id: &amp;lt;%= ENV[&#39;AWS_SUBNET_ID&#39;]  %&amp;gt;
  associate_public_ip: true
  instance_type: t2.micro

transport:
  username: ec2-user
  aws_ssh_key_id: &amp;lt;%= ENV[&#39;AWS_SSH_KEY_ID&#39;]  %&amp;gt;
  ssh_key: &amp;lt;%= ENV[&#39;AWS_SSH_KEY_PATH&#39;] %&amp;gt;

provisioner:
  name: shell

platforms:
  - name: hiphop-amimoto
    driver:
      image_id: ami-xxxxxxxx
  - name: pvm-amimoto
    driver:
      image_id: ami-xxxxxxxx
      instance_type: m1.small
  - name: hvm-amimoto
    driver:
      image_id: ami-xxxxxxxx

verifier:
  name: shell
  command: bundle exec rspec -fd

suites:
  - name: default
    run_list:
    attributes:
&amp;lt;%
## Periodic outputs for CircleCI
if ENV[&#39;CI&#39;]
  ppid = Process.pid
  Process.fork {
    loop {
      puts &amp;quot;.&amp;quot;
      begin
        Process.getpgid( ppid )
        sleep 20
      rescue
        exit 0
      end
    }
  }
end
%&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;導入当初、PVMのインスタンスタイプにはt1.microを使っていた。&lt;br /&gt;
しかしこのインスタンス、WordPressのセットアップ完了直後に&lt;code&gt;yum update&lt;/code&gt;をかけると、わりと高い確率で暫くの間まともに応答しなくなっていた。そのまま10分ほどCircleCIでアウトプット無しの状態が続くと、Failで終わってしまう。&lt;/p&gt;

&lt;p&gt;しかたがないので何か出力しておくため、Test-Kitchen実行時にダミー出力を行うプロセスをフォークで作ったのが末尾のRubyコード部分だ。&lt;br /&gt;
通常、&lt;code&gt;circle.yml&lt;/code&gt;などでバックグラウンドプロセスを起動すると、安易な時間切れ対策対策？として出力はミュートされる仕組みになっているが、テスト内でのフォークは流石に捕まらないようだ。&lt;/p&gt;

&lt;p&gt;結局t1.microは時間がかかりすぎる事が多かったので、先日smallに変更した。強制終了まで2時間(!)かかることがあったりもしたし。&lt;/p&gt;

&lt;h3 id=&#34;herokuからcircleciのビルドをキック:8c9a8fc68efb413605d2b51dc15e5bec&#34;&gt;herokuからCircleCIのビルドをキック&lt;/h3&gt;

&lt;p&gt;CircleCIは定期実行する仕組みを提供していない(目的外だし)ため、任意のブランチのHEADをビルドするRakeタスクを作成。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;require &#39;circleci&#39;
require &#39;logger&#39;
@logger = Logger.new($stdout)

CircleCi.configure do |config|
  config.token = ENV[&#39;CIRCLECI_TOKEN&#39;]
end

task :default do
  begin
    @logger.info &amp;quot;Run nightly integration&amp;quot;
    res = CircleCi::Project.build_branch &#39;Launch-with-1-Click&#39;, &#39;amimoto_die_hard&#39;, &#39;master&#39;
    @logger.info res.code
    unless res.success
      @logger.error &amp;quot;Maybe fail, it will notifies to some service.&amp;quot;
    end
  rescue =&amp;gt; e
    @logger.error e.class
    @logger.error e.message
  end
end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;あとはこれをherokuにおいて、スケジューラから定期的に実行する。&lt;/p&gt;

&lt;h2 id=&#34;まとめ:8c9a8fc68efb413605d2b51dc15e5bec&#34;&gt;まとめ&lt;/h2&gt;

&lt;p&gt;もともとコケるたびにデジタルキューブさん側で対策込みの改善もしていたので、もうこれにほとんど引っかかったりはしません。&lt;br /&gt;
ただ、意識外で起こる不思議な障害のなるはや検知には、抜き打ちテストを回しておくのがいいよね。&lt;/p&gt;

&lt;h2 id=&#34;関連項目:8c9a8fc68efb413605d2b51dc15e5bec&#34;&gt;関連項目&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.adventar.org/calendars/1107&#34;&gt;AMIMOTO Advent Calendar 2015&lt;/a&gt; ひとつ前の記事 =&amp;gt; &lt;a href=&#34;http://wp-kyoto.net/go-to-wordcamp-us/&#34; title=&#34;[AMIMOTOアドベントカレンダー]WordCamp US現地からブースの様子をお送りします - WP-kyoto&#34;&gt;[AMIMOTOアドベントカレンダー]WordCamp US現地からブースの様子をお送りします - WP-kyoto&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.adventar.org/calendars/1107&#34;&gt;AMIMOTO Advent Calendar 2015&lt;/a&gt; 次の記事 =&amp;gt; 公開されたらリンク&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;外部リンク:8c9a8fc68efb413605d2b51dc15e5bec&#34;&gt;外部リンク&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://ja.amimoto-ami.com/&#34; title=&#34;WordPress 専用の AWS + クラウドホスティング AMIMOTO | 超高速 WordPress AMI AMIMOTO&#34;&gt;超高速 WordPress AMI AMIMOTO&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    
    
    <item>
      <title>Test-KitchenのShell-Verifierがマージされた</title>
      <link>http://www.sawanoboly.net/2015/12/tk-shell-verifier-merged-into-master/</link>
      <pubDate>Tue, 01 Dec 2015 14:17:10 +0900</pubDate>
      
      <guid>http://www.sawanoboly.net/2015/12/tk-shell-verifier-merged-into-master/</guid>
      <description>&lt;p&gt;これでRubyGemsの&lt;a href=&#34;https://rubygems.org/gems/kitchen-verifier-shell&#34; title=&#34;kitchen-verifier-shell | RubyGems.org | your community gem host&#34;&gt;kitchen-verifier-shell&lt;/a&gt;は御役御免となりそう。&lt;/p&gt;

&lt;p&gt;ことの次第などはQiitaに昔書いちゃったのでそっちに。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://qiita.com/sawanoboly/items/4898bb4f277e5cacfb6c&#34; title=&#34;Test-KitchenでServerspecやInfratasterをShell-Verifierから実行 - Qiita&#34;&gt;Test-KitchenでServerspecやInfratasterをShell-Verifierから実行 - Qiita&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Test-Kitchenの1.4でVerifierがモジュール形式になり、Busserが唯一の共通処理からいちモジュールに身を落とした時点でこうなるよなーと。&lt;/p&gt;

&lt;p&gt;マージには足掛け半年くらいかかったわけだが、前回&lt;code&gt;exec&lt;/code&gt;コマンドを追加するプルリクエストを送った時もそのくらいかかった。&lt;/p&gt;

&lt;p&gt;今回はChef Incの人が来日した際にその場にいた&lt;a href=&#34;https://twitter.com/dai_lxr&#34;&gt;@dai_lxr&lt;/a&gt;にPushしてもらったのがよかったのかもしれない。&lt;/p&gt;

&lt;p&gt;&lt;blockquote class=&#34;twitter-tweet&#34; data-conversation=&#34;none&#34; lang=&#34;ja&#34;&gt;&lt;p lang=&#34;ja&#34; dir=&#34;ltr&#34;&gt;Q. kitchen-verifier-shellのPRを取り込んで！ &lt;a href=&#34;https://t.co/IjmguH3YNq&#34;&gt;https://t.co/IjmguH3YNq&lt;/a&gt;&amp;#10;A. 取り込まれてよい状態だと思う。私からも言っておくがメンテナに再度pingしてほしい。 &lt;a href=&#34;https://twitter.com/hashtag/chef_docker?src=hash&#34;&gt;#chef_docker&lt;/a&gt; &lt;a href=&#34;https://twitter.com/hashtag/getchef?src=hash&#34;&gt;#getchef&lt;/a&gt; &lt;a href=&#34;https://twitter.com/sawanoboly&#34;&gt;@sawanoboly&lt;/a&gt;&lt;/p&gt;&amp;mdash; dai / Chef活用ガイド発売中 (@dai_lxr) &lt;a href=&#34;https://twitter.com/dai_lxr/status/664446367159484416&#34;&gt;2015, 11月 11&lt;/a&gt;&lt;/blockquote&gt; &lt;script async src=&#34;//platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;p&gt;英語書くのが面倒だからIssueでの議論をスキップして突然プルリクってのは、タイミングが合わない時にお互い困るのかな。&lt;/p&gt;
</description>
    </item>
    
    
    
    <item>
      <title>ブログをhugoにしておく</title>
      <link>http://www.sawanoboly.net/2015/11/blog-hugo/</link>
      <pubDate>Sun, 29 Nov 2015 17:20:22 +0900</pubDate>
      
      <guid>http://www.sawanoboly.net/2015/11/blog-hugo/</guid>
      <description>&lt;p&gt;ひとつ前は、何かしらまともな運営をしているブログサービスの使い勝手がみたかったのという理由でSquarespaceに置いていた。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://sawanoboly.squarespace.com&#34;&gt;ひとつ前のブログ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;普通にブログするなら多分いいとこだ。&lt;/p&gt;

&lt;p&gt;それはそれとして、gfmでそのまま保存できそうなのでhugoに。&lt;/p&gt;

&lt;p&gt;以前の記事も今度移しておこう。&lt;/p&gt;
</description>
    </item>
    
    
    
    <item>
      <title>Chef-Solo, Chef-Client LocalMode, Knife-Solo, Knife-Zero and us.</title>
      <link>http://www.sawanoboly.net/2014/12/chef-solo-zero-knife-solo-zero/</link>
      <pubDate>Thu, 25 Dec 2014 00:00:00 +0900</pubDate>
      
      <guid>http://www.sawanoboly.net/2014/12/chef-solo-zero-knife-solo-zero/</guid>
      <description>

&lt;blockquote&gt;
&lt;p&gt;※旧ブログから移植。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Chef-Soloが無くなるので、他の何かに乗り換える必要があるのか。 という話に対してKnife-Zeroをダシに何か言っておこう。&lt;/p&gt;

&lt;p&gt;最初に言っておくと、今Chef-Solo、Knife-Soloを使っている人、多分何もしなくていい。&lt;/p&gt;

&lt;h2 id=&#34;登場人物一覧:8859dd2aeb8fa59e101fd23fc46b536d&#34;&gt;登場人物一覧&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;Chef-Solo

&lt;ul&gt;
&lt;li&gt;Chef-Server無しでローカルサーバにChefのレシピを適用する。Chef-Server非互換(11でほぼ改善)。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Chef-Client LocalMode

&lt;ul&gt;
&lt;li&gt;Chef-Server無しでローカルサーバにChefのレシピを適用する。Chef-Server互換。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Knife-Solo

&lt;ul&gt;
&lt;li&gt;レシピ一式を転送し、Chef-Soloをリモートサーバに適用する。&lt;/li&gt;
&lt;li&gt;(追記)全体のワークフローは、VagrantのProvisionerに近い。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Knife-Zero

&lt;ul&gt;
&lt;li&gt;レシピ一式を転送せず、SSH越しにChef-Client LocalModeを実行する。&lt;/li&gt;
&lt;li&gt;(追記)従来のClient／Serverワークフローを踏襲。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;全てのchef-solo関連がにchef-zero-chef-client-localmode-に変更されるというのは飛躍的な判断:8859dd2aeb8fa59e101fd23fc46b536d&#34;&gt;全てのChef-Solo関連がにChef-Zero(Chef-Client LocalMode)に変更されるというのは飛躍的な判断&lt;/h2&gt;

&lt;p&gt;なんとなく騒がれているのは、これの元記事からなのかしら。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.creationline.com/lab/6085&#34;&gt;[和訳] ソロからゼロへ: Chef Clientローカルモードへの移行 #opschefja #getchefja « CREATIONLINE, INC.&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;基本的にこれはサーバのローカルで実行する場合についての話でしょう、まあそれならChef-Client LocalModeに変えるのはほとんど何も変更はいらないのでよくわかります。&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;参考： Chef-RFC031 『This means that chef-solo using &amp;ldquo;local mode&amp;rdquo; must be 100% backwards-compatible with existing chef-solo usage.』&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;で、リモートでやるKnife-Soloについて考えた時に、&amp;rdquo;Chef-Solo無くなる&amp;rdquo;＝&amp;rdquo;Knife-Solo使えなくなる&amp;rdquo;でもないわけです。 Knife-Soloは単なる非公式のプラグインであって、公式がこういう記事でいちいち言及しないでしょうね。&lt;/p&gt;

&lt;h3 id=&#34;少なくともknife-soloはchef-soloと心中なんてしないだろう:8859dd2aeb8fa59e101fd23fc46b536d&#34;&gt;少なくともKnife-SoloはChef-Soloと心中なんてしないだろう&lt;/h3&gt;

&lt;p&gt;日本でKnife-Soloがそこそこ広い認知度を持っているのは、&lt;a href=&#34;http://www.amazon.co.jp/dp/B00BSPH158&#34;&gt;伊藤直也さんの入門Chef Solo - Infrastructure as Code&lt;/a&gt;によるところが大きいでしょう。多分そう、部分的にそう。&lt;/p&gt;

&lt;p&gt;この本で覚えたフローや使い方が今後できなくなるかって言うと多分そんなことはなくて。 Knife-Solo開発陣はChefの動向をちゃんと追っています。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/matschaffer/knife-solo/issues/353&#34;&gt;add local_mode to solo.rb · Issue #353 · matschaffer/knife-solo&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;(関連ディレクトリをまるまる転送、リモートでLocalMode相当の実行形式に変更など)&lt;/p&gt;

&lt;p&gt;ということでKnife-Soloでやっているものは、基本的にそのまま使い続けることもできそうだと思ってます。 実際Chef-Soloって無くなるのかも不明、もしかしたらChef14とか15になれば居なくなるのかもしれませんね。&lt;/p&gt;

&lt;h2 id=&#34;knife-zeroはミニマムなchef-server環境とのアップ-ダウングレード移行パス:8859dd2aeb8fa59e101fd23fc46b536d&#34;&gt;Knife-ZeroはミニマムなChef-Server環境とのアップ/ダウングレード移行パス&lt;/h2&gt;

&lt;p&gt;じゃあKnife-Zeroはどういう位置かというと、Chef-Server環境との相互移行がやりやすいChefの導入方法(の一つ)です。 SSH越しにリモートで実行されるChef-ClientはLocalModeではなく、通常のClientモードとしてChef-Server(SSH元のChef-Zero)に対して接続します。&lt;/p&gt;

&lt;p&gt;なのでKnife-Solo(そもそも私は使ってない)の代わりではなく、既存のChef-Serverを畳む用途で作りました。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Knife-Zeroではじめて、Node数が増えてきたらChef-Serverへ&lt;/li&gt;
&lt;li&gt;Node数が少ないChef-ServerをたたんでKnife-Zeroへ&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Knife-Zeroは、概ねお一人様用Chef-Serverという感じです。node情報ををgit管理できたり、エディタで手元からしれっとattributeを追加できたりという利点とかありますが。 大人数で保守する場合や、継続的にChef-Clientを実行したい場合、Nodeがとても多い場合は多分Chef-Serverのほうがよいのかと思います。&lt;/p&gt;

&lt;h2 id=&#34;knife-zero豆知識:8859dd2aeb8fa59e101fd23fc46b536d&#34;&gt;Knife-Zero豆知識&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;Chef-Zeroは2,000nodeくらいまでなら性能的に問題ない。 (&lt;a href=&#34;http://qiita.com/sawanoboly/items/35dd2f117262f4f21969&#34;&gt;Chef-Zeroのキャパシティが気になったのでRubyでベンチマークをとった - Qiita&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;Knife-Zero制作のきっかけはlightchef(&lt;a href=&#34;https://github.com/ryotarai/itamae&#34;&gt;現itamae(github link)&lt;/a&gt;)

&lt;ul&gt;
&lt;li&gt;Severspec的発想がいいと思った。&lt;/li&gt;
&lt;li&gt;しかし同時に、『インベントリも収集せずに(light)Chefとはどういう了見か』と思った。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Facebookの中の人も、SSH越しのLocalMode(Chef-Zero)を使っている。

&lt;ul&gt;
&lt;li&gt;手抜きのために考える事は同じだなと思いました。&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/chef/chef-zero/issues/86&#34;&gt;SSL support · Issue #86 · opscode/chef-zero&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;最初は本家へのPull Requestとして作成していた

&lt;ul&gt;
&lt;li&gt;とても煩雑なコードになって、説明するのが面倒に。&lt;/li&gt;
&lt;li&gt;とりあえずリリースを優先、楽なKnifeのプラグインとして作成。&lt;/li&gt;
&lt;li&gt;本家にマージしたい。(最近はそうでもない。)&lt;/li&gt;
&lt;li&gt;Chef本体からあまりコードの量的に離れたくない。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;リリース当初の私が書いたコードはほとんど残っていない。

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://twitter.com/yasushia&#34;&gt;@yasushia&lt;/a&gt;氏によってリファクタリングが行われ、とてもスッキリしたのでv1.0.0を付けた。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;(Fixed) Chef12のRC版ではローカルモードが盛大にクラッシュする。

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/opscode/chef/issues/2433&#34;&gt;The localmode doesn&amp;rsquo;t create node object correctly on chef 12. · Issue #2433 · opscode/chef&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Knife-Zeroは自分では便利なので12対応はしておきたいんだけど。&lt;/li&gt;
&lt;li&gt;&lt;em&gt;羅列したこの記事のタイトルで、一番寿命が先に来るのは、もしかしてKnife-Zeroかもしれないよ。&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;(New) 治した！ &lt;a href=&#34;https://github.com/chef/chef/pull/2482&#34;&gt;use Chef::JSONCompat.parse for filecontents #2433 by sawanoboly · Pull Request #2482 · opscode/chef&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;つらつらと書きましたが、Knife-Zeroは色々と楽をできるように作ったので、新規のシステムをChefで作り始めるとか、既存のシステムにChefを導入するとかならKnife-Zeroをおすすめします。&lt;/p&gt;
</description>
    </item>
    
    
    
    <item>
      <title>『Chef活用ガイド コードではじめる構成管理』を書きました</title>
      <link>http://www.sawanoboly.net/2014/04/chefbook/</link>
      <pubDate>Sat, 19 Apr 2014 00:00:00 +0900</pubDate>
      
      <guid>http://www.sawanoboly.net/2014/04/chefbook/</guid>
      <description>

&lt;blockquote&gt;
&lt;p&gt;※旧ブログから移植。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;米Chef社(&lt;a href=&#34;http://www.getchef.com/&#34;&gt;http://www.getchef.com/&lt;/a&gt;)が開発しているChefというソフトウェアの本を、クリエーションライン株式会社の樋口さんと共著しました。&lt;a href=&#34;http://ascii.asciimw.jp/books/books/detail/978-4-04-891985-2.shtml&#34;&gt;アスキー・メディアワークス&lt;/a&gt;さんから出版されてます。&lt;/p&gt;

&lt;p&gt;発売を前に手元に２冊届きました、少々ボリュームのあるサイズ(672P)となっています。&lt;/p&gt;

&lt;img src=&#34;http://www.sawanoboly.net/images/2014/chef_book.png&#34; alt=&#34;&#34; class=&#34;pure-img&#34; &gt;


&lt;h2 id=&#34;何を書いたのか:c4c2c2a15aa3f63bc2a9e0adabb4cb59&#34;&gt;何を書いたのか&lt;/h2&gt;

&lt;p&gt;導入はInfrastructure as Codeという概念について述べています。 その後はInfrastructure as Codeの１要素としてChefを利用することへの助けとなるべく、Chefの全要素を出来る限り詳しく解説しています。&lt;/p&gt;

&lt;p&gt;Chefの解説については書き下ろしと、公式ドキュメントにある要素をいくらか組み直して、細かい解説などを入れながら再構成して章立てした内容になっています。 書き下ろし部分の内容を考えるために最も参考にしたのはChef-Clientのソースコードでした。&lt;/p&gt;

&lt;p&gt;最後に付録として、執筆当時に公式のリファレンスに存在したCookbook(Resources)やLWRPの和訳などをつけています。 付録のうち和訳部分に関しては、重複するサンプルを抽出して読みやすさを調整したり、コードに間違いがある部分などを本家にフィードバックしながら修正したりといった手を加えています。&lt;/p&gt;

&lt;p&gt;本編４５０P、付録が２００P強という内訳です。&lt;/p&gt;

&lt;h3 id=&#34;誰に向けて書いたのか:c4c2c2a15aa3f63bc2a9e0adabb4cb59&#34;&gt;誰に向けて書いたのか&lt;/h3&gt;

&lt;p&gt;導入部分はどちらかというとChefの採用を検討するマネジメント層や、極端なところでITサービスプロバイダの経営層に向けて書いています。 Infrastructure as Codeという概念を引き合いに、最近サービスを支えるインフラに対して提言されているのはこのようなことですよと紹介し、コストやリスクを減らしていきましょうという呼びかけをしています。&lt;/p&gt;

&lt;p&gt;導入部以降はいわゆる現場向けといえそうです。Chefを内部の構造からまあまあ詳細に解説しているので、実際にChefを触ってみたい・触っている・もっと使いこなしたいという方々や、Chefの挙動に興味や疑問を持つ方々に是非読んでいただきたいと思っています。&lt;/p&gt;

&lt;h3 id=&#34;書かれていないこと:c4c2c2a15aa3f63bc2a9e0adabb4cb59&#34;&gt;書かれていないこと&lt;/h3&gt;

&lt;p&gt;そもそもChefだけでインフラの管理がよくなるという事は決してありませんし、この本でも出だしにそう断りを入れています。 コンピュータシステムのライフサイクル管理を効率良く行なうには、用途および組織にあったツールチェーンを確立するのが望ましいことは重々承知ですが、Chefから少し離れる要素や、他のツールからワークフローの一部として使われるChefについては、この本ではほぼ解説していません。&lt;/p&gt;

&lt;p&gt;そして、この本はあくまでガイドという位置づけであり、導入の検討や適用範囲はあくまで組織でのプランやコストを考慮して各自が行わなければなりません。もちろん事例やサンプルもそれなりに書いており、参考にすることもできますが、どこでも通用するベスト・プラクティスというわけでもありません。 (観光ガイドブックであれば、名所の場所は書かれていても、観光レポートは無いでしょう？)&lt;/p&gt;

&lt;p&gt;ただ、テーマをChefだけに絞ったこともあり、現状で書籍という形に限れば世界中で比べても一番Chefについて詳しく書かれた本(あとOhaiも)になっていると思います。 検討の材料、導入後のリファレンスとしても十分役に立つでしょう。&lt;/p&gt;

&lt;h3 id=&#34;なぜ書いたのか:c4c2c2a15aa3f63bc2a9e0adabb4cb59&#34;&gt;なぜ書いたのか&lt;/h3&gt;

&lt;p&gt;至る経緯は諸所ありますが、お話をいただいたからです。&lt;/p&gt;

&lt;p&gt;その時点でそこそこChefを使ったり、他所に導入したりを始めていたので次のような理由で受けました。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;自分がChefを忘れても大丈夫なように、本にまとめておけるならラッキー&lt;/li&gt;
&lt;li&gt;人に説明するときにラク&lt;/li&gt;
&lt;li&gt;人からの質問がいくらか具体的になる&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;どのように書いていたのか:c4c2c2a15aa3f63bc2a9e0adabb4cb59&#34;&gt;どのように書いていたのか&lt;/h3&gt;

&lt;p&gt;動いていたのは2013年7月〜2014年4月、そのうち9月後半〜１月にほとんどの内容が書かれました。
書き始める前はソースコードや関連資料の調査、１月後半からは校正につぐ校正。&lt;/p&gt;

&lt;p&gt;原稿の管理と、共同執筆中のコミュニケーションではこれらが役に立ちました。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;github(git)&lt;/li&gt;
&lt;li&gt;Skype&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;内容はGithubのリポジトリを更新して共有し、やや大きめなテーマはIssueとして管理、ちょっとした方針や文章のすり合わせはSkypeでと、快適な執筆環境を目指してツールを活用することにしました。(Skypeではくだらない雑談も相当交わされましたが)&lt;/p&gt;

&lt;p&gt;共著の樋口さんとは、本について７月(&lt;a href=&#34;http://chef-meetup-kansai.doorkeeper.jp/events/4978&#34;&gt;第１回 Chef Casual Talks Kansai&lt;/a&gt;の翌日)に分担を決めた後は、一度も顔を合わせることなくすべての作業を終えることが出来ました。&lt;/p&gt;

&lt;p&gt;私の側では、主にこれらのツールで原稿を作成しました。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;エディタ(vim, bbedit)&lt;/li&gt;
&lt;li&gt;プレビュー(Mou, Marked, git(差分))&lt;/li&gt;
&lt;li&gt;Chefのソースビュアー(vim, git(差分および履歴))&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;プレビューツールからわかると思いますが、生原稿はMarkdownでした。 原稿書きには、gitのログと差分確認がかなり役立ちます。&lt;/p&gt;

&lt;p&gt;校正段階では主にこれらのツールで原稿の修正にあたりました。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Mail &amp;amp; unzip, mi(旧ミミカキエディット)&lt;/li&gt;
&lt;li&gt;github(git)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;初稿より後は、MarkdownではなくEWBで(変換された)となったんですが、文字コードがEUC-JPでbbeditがイマイチ自動判別しなかったので、国産エディタのmiに頼りました。&lt;/p&gt;

&lt;p&gt;ここでもやっぱりGithubが活躍します。章ごとのブランチを作成して、平行して校正を進めたり、適用漏れを抽出して追跡したり、 gitリポジトリは軽作業などもふくめて、結局2200コミットくらいになりました。&lt;/p&gt;

&lt;img src=&#34;http://www.sawanoboly.net/images/2014/chef_book_commits.png&#34; alt=&#34;&#34; class=&#34;pure-img&#34; &gt;


&lt;p&gt;環境用品のうち、特に活躍した3つをピックアップします。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;MacBook Pro Retina13

&lt;ul&gt;
&lt;li&gt;QuickResで、画面をかなり広くして使用、参考資料を見ながらの執筆に&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Contessa (岡村製作所)

&lt;ul&gt;
&lt;li&gt;作業に集中するのに調度良かった&lt;/li&gt;
&lt;li&gt;腰痛が全然気にならなくなった&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;SHOT NOTE(KING JIM)

&lt;ul&gt;
&lt;li&gt;構成図等の提出はこれに手書きして取り込んだ&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;最後に:c4c2c2a15aa3f63bc2a9e0adabb4cb59&#34;&gt;最後に&lt;/h3&gt;

&lt;p&gt;本書を書くのは中々骨の折れる作業でしたが、周囲の協力者や家族の理解もあって、ようやく書店に置かれる所までこぎつけました。 あとは料理本のコーナーに並ばないことだけを祈っておきます。&lt;/p&gt;

&lt;p&gt;&lt;iframe src=&#34;http://rcm-fe.amazon-adsystem.com/e/cm?lt1=_blank&amp;bc1=000000&amp;IS2=1&amp;bg1=FFFFFF&amp;fc1=000000&amp;lc1=0000FF&amp;t=netsawa-22&amp;o=9&amp;p=8&amp;l=as4&amp;m=amazon&amp;f=ifr&amp;ref=ss_til&amp;asins=4048919857&#34; style=&#34;width:120px;height:240px;&#34; scrolling=&#34;no&#34; marginwidth=&#34;0&#34; marginheight=&#34;0&#34; frameborder=&#34;0&#34;&gt;&lt;/iframe&gt;

&lt;iframe src=&#34;http://rcm-fe.amazon-adsystem.com/e/cm?lt1=_blank&amp;bc1=000000&amp;IS2=1&amp;bg1=FFFFFF&amp;fc1=000000&amp;lc1=0000FF&amp;t=netsawa-22&amp;o=9&amp;p=8&amp;l=as4&amp;m=amazon&amp;f=ifr&amp;ref=ss_til&amp;asins=B0008JIECE&#34; style=&#34;width:120px;height:240px;&#34; scrolling=&#34;no&#34; marginwidth=&#34;0&#34; marginheight=&#34;0&#34; frameborder=&#34;0&#34;&gt;&lt;/iframe&gt;
&lt;/p&gt;

&lt;h3 id=&#34;追記-chef活用ガイド-読者アンケートを作成しました:c4c2c2a15aa3f63bc2a9e0adabb4cb59&#34;&gt;追記、『Chef活用ガイド』読者アンケートを作成しました。&lt;/h3&gt;

&lt;p&gt;この本を読んでいただいた方(購入・回し読み問わず)を対象に、アンケートを作成しました。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://jp.surveymonkey.com/s/HSL5QBK&#34;&gt;書籍『Chef活用ガイド』読者アンケート Survey&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;では締めを&lt;a href=&#34;http://vdr.jp/d/20140421.html&#34;&gt;Chef活用ガイド コードではじめる構成管理 - vdrめも(2014-04-21)&lt;/a&gt;から引用で。&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;世に出るのはもう少し先で、その上読み終えるにはかなりの時間がかかるかと思いますが、よろしければご回答いただければ幸いです。&lt;/p&gt;
&lt;/blockquote&gt;
</description>
    </item>
    
    
  </channel>
</rss>
